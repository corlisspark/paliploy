import{r,j as e,c as P,Q as T}from"./useAuth-g5JMFC9x.js";/* empty css               */import{u as S,a as E,H as L}from"./Header-COD7X1WY.js";import{c as N,U as I,P as U}from"./user-DSFq6umH.js";import{V as _}from"./VendorModal-BH7wcwAH.js";function R(){return S({queryKey:["config","vendors"],queryFn:async()=>{let n=0;for(;!window.db&&n<50;)await new Promise(t=>setTimeout(t,100)),n++;const a=window.db;if(!a)return{items:[],lastUpdated:new Date};try{const t=await a.collection("admin_config").doc("vendors").get();if(t.exists)return t.data()}catch(t){console.warn("Could not fetch vendor config:",t)}return{items:[],lastUpdated:new Date}},staleTime:300*1e3,retry:2})}function D(){return S({queryKey:["config","locations"],queryFn:async()=>{let n=0;for(;!window.db&&n<50;)await new Promise(t=>setTimeout(t,100)),n++;const a=window.db;if(!a)return{items:[],lastUpdated:new Date};try{const t=await a.collection("admin_config").doc("locations").get();if(t.exists)return t.data()}catch(t){console.warn("Could not fetch location config:",t)}return{items:[],lastUpdated:new Date}},staleTime:300*1e3,retry:2})}function $(){const{data:n}=R();return n?.items?.filter(a=>a.isActive)||[]}function q(){const{data:n}=D();return n?.items?.filter(a=>a.isActive)||[]}function O(){const{data:n}=R(),a={};return n?.items?.forEach(t=>{t.isActive&&t.id&&(a[t.id]={color:t.color||"#95a5a6",icon:t.icon||t.name?.charAt(0)?.toUpperCase()||"?"})}),a}function V(){const{data:n}=D(),a={};return n?.items?.forEach(t=>{t.isActive&&t.id&&t.lat&&t.lng&&(a[t.id]={lat:t.lat,lng:t.lng})}),a}function z({vendors:n,onVendorClick:a,center:t}){const d=r.useRef(null),u=r.useRef(null),g=r.useRef([]),[h,p]=r.useState(!1),[m,w]=r.useState(!!window.google),x=O(),v=V();return r.useEffect(()=>{if(window.google){w(!0);return}const i=setInterval(()=>{window.google&&(w(!0),clearInterval(i))},200);return()=>clearInterval(i)},[]),r.useEffect(()=>{if(!d.current||!window.google||!m)return;const i=Object.values(v)[0],k=t||i||{lat:41.824,lng:-71.4128};u.current=new google.maps.Map(d.current,{zoom:10,center:k,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),p(!0)},[t,m]),r.useEffect(()=>{!u.current||!h||(g.current.forEach(i=>i.setMap(null)),g.current=[],n.forEach(i=>{const k=x[i.vendor]||{color:"#95a5a6",icon:"?"},b=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:u.current,icon:{url:`data:image/svg+xml,${encodeURIComponent(`<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
              <circle cx="16" cy="16" r="14" fill="${k.color}" stroke="white" stroke-width="3"/>
              <text x="16" y="20" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="12" font-weight="bold">${k.icon}</text>
            </svg>`)}\`,scaledSize:new google.maps.Size(32,32),anchor:new google.maps.Point(16,16)},title:i.title});b.addListener("click",()=>{u.current?.panTo(b.getPosition()),u.current?.setZoom(Math.max(u.current.getZoom()||10,14)),a(i)}),g.current.push(b)}))},[n,h,a]),e.jsx("div",{ref:d,id:"map",style:{width:"100%",height:"100%"}})}
/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],B=N("map-pin",Q);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],M=N("search",F);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],G=N("x",K);function H({onSearch:n,onResultClick:a,placeholder:t="Search packs, vendors, locations..."}){const[d,u]=r.useState(""),[g,h]=r.useState(!1),[p,m]=r.useState(-1),w=r.useRef(null),i=r.useRef(null),{data:x=[]}=E(),v=$(),C=q(),j=r.useCallback(()=>{if(!d.trim())return[];const s=[],f=d.toLowerCase();return x.filter(c=>c.title?.toLowerCase().includes(f)||c.vendor?.toLowerCase().includes(f)).slice(0,5).forEach(c=>{s.push({id:c.id,title:c.title,vendor:c.vendor,city:c.city,type:"pack"})}),v.filter(c=>c.name?.toLowerCase().includes(f)).slice(0,3).forEach(c=>{s.push({id:c.id,title:c.name,vendor:c.name,city:"",type:"vendor"})}),C.filter(c=>c.name?.toLowerCase().includes(f)).slice(0,3).forEach(c=>{s.push({id:c.id,title:c.name,vendor:"",city:c.name,type:"location"})}),s},[d,x,v,C])(),l=s=>{u(s),m(-1),h(s.trim().length>0),n(s)},o=()=>{u(""),h(!1),m(-1),n(""),w.current?.focus()},y=s=>{u(s.title),h(!1),a(s)},b=s=>{if(g)switch(s.key){case"ArrowDown":s.preventDefault(),m(f=>Math.min(f+1,j.length-1));break;case"ArrowUp":s.preventDefault(),m(f=>Math.max(f-1,-1));break;case"Enter":s.preventDefault(),p>=0&&j[p]&&y(j[p]);break;case"Escape":s.preventDefault(),h(!1),m(-1),w.current?.blur();break}};r.useEffect(()=>{const s=f=>{i.current&&!i.current.contains(f.target)&&h(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const A=s=>{switch(s){case"pack":return e.jsx(U,{className:"h-4 w-4 text-blue-500"});case"vendor":return e.jsx(I,{className:"h-4 w-4 text-green-500"});case"location":return e.jsx(B,{className:"h-4 w-4 text-purple-500"});default:return e.jsx(M,{className:"h-4 w-4 text-gray-400"})}};return e.jsx("div",{className:"floating-search-overlay",ref:i,children:e.jsxs("div",{className:"floating-search-box",children:[e.jsxs("div",{className:"search-input-container",children:[e.jsx(M,{className:"h-5 w-5 text-gray-400 ml-1"}),e.jsx("input",{ref:w,type:"text",value:d,onChange:s=>l(s.target.value),onKeyDown:b,onFocus:()=>d.trim()&&h(!0),placeholder:t,autoComplete:"off",className:"flex-1 px-3 py-2 border-0 focus:outline-none focus:ring-0 bg-transparent"}),d&&e.jsx("button",{className:"search-clear-btn p-1 hover:bg-gray-100 rounded",onClick:o,type:"button",children:e.jsx(G,{className:"h-4 w-4 text-gray-400"})})]}),g&&j.length>0&&e.jsx("div",{className:"search-dropdown border-t bg-white rounded-b-lg shadow-lg max-h-64 overflow-y-auto",children:e.jsx("div",{className:"py-1",children:j.map((s,f)=>e.jsxs("button",{className:`w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center space-x-3 ${p===f?"bg-blue-50 border-l-2 border-blue-500":""}`,onClick:()=>y(s),onMouseEnter:()=>m(f),children:[A(s.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),s.vendor&&s.type==="pack"&&e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[s.vendor," ‚Ä¢ ",s.city]}),s.type==="vendor"&&e.jsx("div",{className:"text-xs text-gray-500",children:"Vendor"}),s.type==="location"&&e.jsx("div",{className:"text-xs text-gray-500",children:"Location"})]})]},`${s.type}-${s.id}`))})}),g&&d.trim()&&j.length===0&&e.jsx("div",{className:"search-dropdown border-t bg-white rounded-b-lg shadow-lg",children:e.jsxs("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:['No results found for "',d,'"']})})]})})}function Z(){const{data:n=[],isLoading:a}=E(),t=V(),[d,u]=r.useState(null),[g,h]=r.useState(!1),[p,m]=r.useState([]),[w,i]=r.useState({lat:41.824,lng:-71.4128});r.useEffect(()=>{const l=Object.values(t)[0];l&&i(l)},[t]),r.useEffect(()=>{const l=n.map(o=>{if(o.lat&&o.lng)return o;const y=t[o.city];return{...o,lat:y?.lat||41.824,lng:y?.lng||-71.4128}});m(l)},[n,t]);const x=l=>{u(l),h(!0)},v=()=>{h(!1),u(null)},C=l=>{if(!l.trim()){m(n);return}const o=l.toLowerCase(),y=n.filter(b=>b.title?.toLowerCase().includes(o)||b.vendor?.toLowerCase().includes(o)||b.city?.toLowerCase().includes(o));m(y)},k=l=>{if(l.type==="pack"){const o=n.find(y=>y.id===l.id);o&&x(o)}else if(l.type==="location"){const o=t[l.id];o&&i(o)}},j=()=>{const o=window.locationManager?.getCurrentCity();o&&i({lat:o.lat,lng:o.lng})};return a?e.jsxs("div",{className:"app-container",children:[e.jsx(L,{currentPage:"map"}),e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading packs..."})]})})]}):(console.log("MapApp render:",{vendorsCount:n.length,filteredCount:p.length,isLoading:a,googleMaps:!!window.google,currentCity:w}),e.jsxs("div",{className:"app-container",children:[e.jsx(L,{currentPage:"map"}),e.jsx("div",{className:"main-content",children:e.jsxs("div",{className:"map-container",style:{height:"100%",width:"100%",position:"relative"},children:[window.google?e.jsx(z,{vendors:p,onVendorClick:x,center:w}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-100",children:e.jsx("p",{className:"text-gray-600",children:"Loading Google Maps..."})}),e.jsx(H,{onSearch:C,onResultClick:k}),e.jsx("button",{className:"absolute bottom-4 right-4 bg-white p-3 rounded-full shadow-lg hover:bg-gray-50",onClick:j,children:"üìç"}),p.length===0&&!a&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No packs found"}),e.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or location"})]})]})}),e.jsx("div",{className:"bottom-toolbar",children:e.jsxs("nav",{className:"toolbar-nav",children:[e.jsxs("a",{href:"index.html",className:"nav-item active",children:[e.jsx("span",{className:"nav-icon",children:"üó∫Ô∏è"}),e.jsx("span",{children:"Map"})]}),e.jsxs("a",{href:"listings.html",className:"nav-item",children:[e.jsx("span",{className:"nav-icon",children:"üìã"}),e.jsx("span",{children:"Browse"})]}),e.jsxs("a",{href:"new.html",className:"nav-item",children:[e.jsx("span",{className:"nav-icon",children:"‚ûï"}),e.jsx("span",{children:"Post"})]}),e.jsxs("a",{href:"account.html",className:"nav-item",children:[e.jsx("span",{className:"nav-icon",children:"üë§"}),e.jsx("span",{children:"Account"})]})]})}),e.jsx(_,{vendor:d,isOpen:g,onClose:v})]}))}P.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(T,{children:e.jsx(Z,{})})}));
